---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(purrr)
```

# Reading in data, removing duplicate variables or concantenating variables, and improving clarity of column names

```{r}
CA <- read_tsv("EventResults.txt", col_names = TRUE, skip = 1)  

CA <- CA %>% 
  rename_with(~ str_remove(.x, "-.*")) %>% 
  mutate(Full_name = str_c(`Given name `, `Surname `, sep = " "), .keep = "unused") %>% 
  select(-`Nom de la circonscription`, -`Type de rÃ©sultats**`, -`Middle name(s) `, -`Appartenance politique`) %>% 
  filter(`Type of results*` == "validated") %>%  
  select(-`Type of results*`, - `Electoral district number `) %>% 
  mutate(Total_valid_votes = `Total number of ballots cast ` - `Rejected ballots `, .keep = "unused")
```


# Removing full name of political parties with acronyms

```{r}
CA$`Political affiliation`[CA$`Political affiliation` == "NDP-New Democratic Party"] <- "NDP"
CA$`Political affiliation`[CA$`Political affiliation` == "People's Party - PPC"] <- "PPC"
CA$`Political affiliation`[CA$`Political affiliation` == "CFF - Canada's Fourth Front"] <- "CFF"
```


# Ranking candidates by the number of votes they recieved and assigning a variable to winners and losers to each parliamentary riding

```{r}
CA <- CA %>% 
  group_by(`Electoral district name`) %>% 
  mutate(Rank = rank(-`Votes obtained `)) %>% 
  mutate(Winner = if_else(Rank == 1, "Winner", "Loser"))

CA$Rank <- as_factor(CA$Rank)

head(CA)
```

# Updating election results if the PPC never existed and their voters instead voted for the Conservatives

```{r}
CA1 <- CA %>%
  group_by(`Electoral district name`) %>% 
  mutate(New_PA = recode(`Political affiliation`, PPC = 'Conservative')) %>% 
  group_by(`Electoral district name`, New_PA) %>% 
  mutate(`New_PA` = str_c(`New_PA`),
            Votes_Obtained = sum(`Votes obtained `)) %>% 
  filter(`Political affiliation` != "PPC") %>% 
  select(- `Political affiliation`, - `Votes obtained `, - `% Votes obtained `, -`Total_valid_votes`) %>% 
  group_by(`Electoral district name`) %>% 
  mutate(Rank = rank(-Votes_Obtained)) %>%
  mutate(Winner = if_else(Rank == 1, "Winner", "Loser")) 

CA1$Rank <- as_factor(CA1$Rank)

head(CA1)
```


# Comparing parliament results of CA (actual) and CA1 (actual but all PPC voters go the Conservatives)


```{r}
CA1 %>% 
  group_by(New_PA) %>% 
  count(Winner) %>% 
  filter(Winner == "Winner") %>% 
  select(-Winner) %>% 
  rename("MP's" = n)
```

```{r}
CA %>% 
  group_by(`Political affiliation`) %>% 
  count(Winner) %>% 
  filter(Winner == "Winner") %>% 
  select(-Winner) %>% 
  rename("MP's" = n)
```













